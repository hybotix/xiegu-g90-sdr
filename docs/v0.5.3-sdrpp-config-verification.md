# v0.5.3 SDR++ Configuration Verification

## Summary
This document verifies all SDR++ rigctl_server checkboxes are properly configured.

## Three Required Checkboxes

The SDR++ Rigctl Server has three checkboxes that **MUST ALL BE CHECKED**:

1. **☑ Tuning** - Allows frequency control from external apps
2. **☑ Recording** - Enables recording control
3. **☑ Listen on startup** - Auto-starts rigctl server when SDR++ launches

## Configuration File Location

- **Path:** `~/.config/sdrpp/rigctl_server_config.json`
- **Created by:** `scripts/configure_sdrpp.py`

## Configuration Content

```json
{
  "host": "localhost",
  "port": 4532,
  "tuning": true,
  "recording": true,
  "autoStart": true,
  "vfo": "",
  "recorder": ""
}
```

## Verification Steps for Fresh Install

### 1. Clean Slate
```bash
rm -rf ~/.config/sdrpp
```

### 2. Run Configuration
```bash
python3 scripts/configure_sdrpp.py
```

### 3. Verify Config File
```bash
cat ~/.config/sdrpp/rigctl_server_config.json
```

**Expected output:**
```json
{
  "host": "localhost",
  "port": 4532,
  "tuning": true,
  "recording": true,
  "autoStart": true,
  "vfo": "",
  "recorder": ""
}
```

### 4. Start SDR++ and Verify Checkboxes

```bash
sdrpp &
```

**In SDR++ UI:**
1. Click hamburger menu (≡)
2. Scroll to "Rigctl Server"
3. Click to expand

**You should see all three boxes CHECKED:**
- ☑ Tuning
- ☑ Listen on startup
- ☑ Recording

**Host/Port should show:**
- Host: localhost
- Port: 4532

### 5. Verify Port is Listening

```bash
ss -lntp | grep 4532
```

**Expected:** Should show sdrpp listening on 127.0.0.1:4532

### 6. Run Full Diagnostic

```bash
python3 tests/TestSdrppConfig.py
```

**Expected results:**
- ✓ Main config exists
- ✓ Rigctl Server enabled=True
- ✓ Rigctl config exists
- ✓ host: localhost
- ✓ port: 4532
- ✓ autoStart: True
- ✓ SDR++ is running
- ✓ Port 4532 is listening
- ✓ Successfully connected to port 4532

## What Gets Configured

### Primary Config: rigctl_server_config.json
- Sets all three checkbox values
- Configures host=localhost, port=4532
- Stored in: `~/.config/sdrpp/rigctl_server_config.json`

### Main SDR++ Config: config.json
- Enables the rigctl_server module instance
- Module name: "Rigctl Server"
- Stored in: `~/.config/sdrpp/config.json`

### During Installation
- `install.bash` Step 10 runs `configure_sdrpp.py` automatically
- Creates both config files
- No manual SDR++ configuration needed

## Troubleshooting

### If checkboxes are unchecked after fresh config:

1. **Delete configs and recreate:**
   ```bash
   rm -rf ~/.config/sdrpp
   python3 scripts/configure_sdrpp.py
   ```

2. **Check for config file corruption:**
   ```bash
   python3 -m json.tool ~/.config/sdrpp/rigctl_server_config.json
   ```
   (Should show valid JSON without errors)

3. **Manually verify each setting:**
   ```bash
   cat ~/.config/sdrpp/rigctl_server_config.json | grep -E "tuning|recording|autoStart"
   ```
   (All three should be `true`)

### If port 4532 not listening:

Even with checkboxes configured, the first SDR++ launch may not auto-start.

**Workaround:**
1. Start SDR++
2. Click "Rigctl Server" in menu
3. Manually check "Tuning" box (this triggers the server to start)
4. Close SDR++
5. Restart SDR++ - should auto-start now

## Code Verification

### File: scripts/configure_sdrpp.py

**Lines 23-31:** Creates config with all three enabled
```python
rigctl_config = {
    "host": "localhost",
    "port": 4532,
    "tuning": True,        # ✓ Checkbox 1
    "recording": True,     # ✓ Checkbox 2
    "autoStart": True,     # ✓ Checkbox 3
    "vfo": "",
    "recorder": ""
}
```

**Lines 43-52:** Validates and corrects existing configs
```python
# Ensure all three checkboxes are enabled
if not existing.get('tuning', False):
    existing['tuning'] = True
if not existing.get('recording', False):
    existing['recording'] = True
if not existing.get('autoStart', False):
    existing['autoStart'] = True
```

## Status: VERIFIED ✓

All three rigctl_server checkboxes are properly configured:
- ✓ tuning = true
- ✓ recording = true
- ✓ autoStart = true

Configuration is correct and ready for fresh system testing.
